<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    
    <!--bootstrap css -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

    <!-- bootstrap js -->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js" integrity="sha384-vFJXuSJphROIrBnz7yo7oB41mKfc8JzQZiCq4NCceLEaO4IHwicKwpJf9c9IpFgh" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js" integrity="sha384-alpBpkh1PFOepccYVYDB4do5UnbKysX5WZXm3XxPqe5iKTfUKjNkCk9SaVuEZflJ" crossorigin="anonymous"></script>
    
	  <!-- blocly js -->
    <script src="../blockly/blockly_compressed.js"></script>
    <!-- Language -->
    <script src="../blockly/python_compressed.js"></script> 
    <script src="../blockly/blocks_compressed.js"></script>
    <script src="../blockly/msg/js/pt-br.js"></script>
  
  	<!-- micropyb css -->
    <link rel="stylesheet" href="micropyb.css">
  
    <title>MicropyB</title>
    <link rel="icon" href="imgs/micropybLogo.png">
  </head>

  <body>
  
    <!-- top menu -->
	<nav class="navbar navbar-expand-lg navbar-light bg-light">
	  <a class="navbar-brand ml-4" href="#"><img src="imgs/micropyblogo2.png" /></a>
    <span class="navbar-text"><h3>MicropyB</h3></span>
    
    <img id="save-btn" class="btn btn-sm ml-5 btn-menu" src="imgs/save_black_54x54.png" title="Salvar" onclick="saveSketch()" />

    <img id="send-btn" class="btn btn-sm ml-2 btn-menu" src="imgs/send_black_54x54.png" title="Enviar" onclick="send2board()" />

	</nav>
	<!-- content -->
  <div class="container-fluid">
    <div class="row">
      <!--blockly area-->
		  <div class="ml-5 mt-4"  id="blocklyArea">
		    <div class="panel-body" id="blocklyDiv"></div><!-- criar uma div para reservar o lugar da �rea do blockly mudar para o modelo resizable (problemas em criar uma div externa com espa�o reservado) -->
      </div>

      <!-- source code area-->
      <div class="card col-3 ml-4 mt-4 bg-light" id="codebox">
	      <div class="card-title text-center">
	       <b> <> Código MicroPython</b>
	      </div>
	      <div class="card-text bg-light"><pre id="codearea"></pre></div>
      </div>

    </div>
  </div>
    <!--terminal area
    <div id="accordion" role="tablist">
      <div class="card fixed-bottom">
        <div class="card-header" role="tab" id="terminalTitle">
          <button type="button" class="btn ml-4" data-toggle="collapse" data-target="#terminal" aria-expanded="false" aria-controls="terminal">Terminal</button>
        </div>
      
        <div id="terminal" class="collapse" role="tabpanel" aria-labelledby="headingOne" data-parent="#accordion">
          <div class="card-body">
            inserir codigo do teminal aqui
          </div>
        </div>
      </div>
    </div>-->
  
	
	<!-- toolbox -->
  <xml xmlns="http://www.w3.org/1999/xhtml" id="toolbox" style="display: none;">
    <category name="Lógicos" colour="#5C81A6">
      <block type="controls_if"></block>
      <block type="logic_compare">
        <field name="OP">EQ</field>
      </block>
      <block type="logic_operation">
        <field name="OP">AND</field>
      </block>
      <block type="logic_negate"></block>
      <block type="logic_boolean">
        <field name="BOOL">TRUE</field>
      </block>
      <block type="logic_null"></block>
      <block type="logic_ternary"></block>
    </category>
    <category name="Laços" colour="#5CA65C">
      <block type="controls_repeat_ext">
        <value name="TIMES">
          <shadow type="math_number">
            <field name="NUM">10</field>
          </shadow>
        </value>
      </block>
      <block type="controls_whileUntil">
        <field name="MODE">WHILE</field>
        <statement name="DO">
          <block type="controls_flow_statements">
            <field name="FLOW">BREAK</field>
          </block>
        </statement>
      </block>
    </category>
    <category name="Matemáticos" colour="#5C68A6">
      <block type="math_round">
        <field name="OP">ROUND</field>
        <value name="NUM">
          <shadow type="math_number">
            <field name="NUM">3.1</field>
          </shadow>
        </value>
      </block>
      <block type="math_number">
        <field name="NUM">0</field>
      </block>
      <block type="math_single">
        <field name="OP">ROOT</field>
        <value name="NUM">
          <shadow type="math_number">
            <field name="NUM">9</field>
          </shadow>
        </value>
      </block>
      <block type="math_trig">
        <field name="OP">SIN</field>
        <value name="NUM">
          <shadow type="math_number">
            <field name="NUM">45</field>
          </shadow>
        </value>
      </block>
      <block type="math_constant">
        <field name="CONSTANT">PI</field>
      </block>
      <block type="math_number_property">
        <mutation divisor_input="false"></mutation>
        <field name="PROPERTY">EVEN</field>
        <value name="NUMBER_TO_CHECK">
          <shadow type="math_number">
            <field name="NUM">0</field>
          </shadow>
        </value>
      </block>
      <block type="math_arithmetic">
        <field name="OP">ADD</field>
        <value name="A">
          <shadow type="math_number">
            <field name="NUM">1</field>
          </shadow>
        </value>
        <value name="B">
          <shadow type="math_number">
            <field name="NUM">1</field>
          </shadow>
        </value>
      </block>
      <block type="math_modulo">
        <value name="DIVIDEND">
          <shadow type="math_number">
            <field name="NUM">64</field>
          </shadow>
        </value>
        <value name="DIVISOR">
          <shadow type="math_number">
            <field name="NUM">10</field>
          </shadow>
        </value>
      </block>
      <block type="math_random_int">
        <value name="FROM">
          <shadow type="math_number">
            <field name="NUM">1</field>
          </shadow>
        </value>
        <value name="TO">
          <shadow type="math_number">
            <field name="NUM">100</field>
          </shadow>
        </value>
      </block>
      <block type="math_random_float"></block>
    </category>
    <category name="Texto" colour="#5CA68D">
      <block type="text_charAt">
        <mutation at="true"></mutation>
        <field name="WHERE">FROM_START</field>
        <value name="VALUE">
          <block type="variables_get">
            <field name="VAR" id="hFFXpyk,|C:B_#^IP1aR" variabletype="">text</field>
          </block>
        </value>
      </block>
      <block type="text">
        <field name="TEXT"></field>
      </block>
      <block type="text_append">
        <field name="VAR" id="RZk|uWGAp1do)/~dL)N@" variabletype="">item</field>
        <value name="TEXT">
          <shadow type="text">
            <field name="TEXT"></field>
          </shadow>
        </value>
      </block>
      <block type="text_length">
        <value name="VALUE">
          <shadow type="text">
            <field name="TEXT">abc</field>
          </shadow>
        </value>
      </block>
      <block type="text_print">
        <value name="TEXT">
          <shadow type="text">
            <field name="TEXT">abc</field>
          </shadow>
        </value>
      </block>
      <block type="readline"></block>
    </category>
    <category name="Variáveis" colour="#A65C81" custom="VARIABLE"></category>
    <category name="Funções" colour="#9A5CA6" custom="PROCEDURE">
      <block type="main_func"></block>
    </category>
    <category name="Pino" colour="#a5a55b">
      <block type="pin_declare">
        <field name="type_pin">OUT</field>
      </block>
      <block type="pin_on">
        <field name="pin_var" id="VU|iA}$r0XefNyBLeBgl" variabletype="">item</field>
      </block>
      <block type="pin_off">
        <field name="pin_var" id="VU|iA}$r0XefNyBLeBgl" variabletype="">item</field>
      </block>
      <block type="pin_set_value">
        <field name="pin" id="VU|iA}$r0XefNyBLeBgl" variabletype="">item</field>
      </block>
      <block type="pin_get_value">
        <field name="pin" id="VU|iA}$r0XefNyBLeBgl" variabletype="">item</field>
      </block>
    </category>
    <category name="PWM" colour="#80a55b">
      <block type="pwm_freq">
        <field name="NAME" id="v+45qGGrt}a05X=O2P8l" variabletype="">item</field>
      </block>
      <block type="pwm_duty">
        <field name="NAME" id="v+45qGGrt}a05X=O2P8l" variabletype="">item</field>
      </block>
    </category>
    <category name="DHT" colour="#5ba580">
      <block type="dht_medir">
        <field name="NAME" id="8wja!3Jna/a[Oc/#7o(l" variabletype="">item</field>
      </block>
      <block type="dht_umidade">
        <field name="NAME" id="8wja!3Jna/a[Oc/#7o(l" variabletype="">item</field>
      </block>
      <block type="dht_temp">
        <field name="NAME" id="8wja!3Jna/a[Oc/#7o(l" variabletype="">item</field>
      </block>
    </category>
    <category name="Rede" colour="#a55b93">
      <block type="server">
        <field name="debug">TRUE</field>
      </block>
      <block type="wifi">
        <field name="wifimod">station</field>
      </block>
      <block type="send_data"></block>
      <block type="socket_accept"></block>
      <block type="close_conection"></block>
    </category>
    <category name="Outros" colour="#a55b5b">
      <block type="time_sleep"></block>
      <block type="makefile"></block>
    </category>
  </xml>
  
  <!-- workspace blocks -->
  <xml xmlns="http://www.w3.org/1999/xhtml" id="workspaceBlocks" style="display:none">
    <variables></variables>
    <block type="main_func" id="Ny-nka=1D2_*jEtme:S+" x="38" y="38"></block>
  </xml>


  <!-- Injecao dos blocos na area da div -->
  <script> 
      var blocklyArea = document.getElementById('blocklyArea');
      var blocklyDiv = document.getElementById('blocklyDiv');
	    var workspacePlayground = Blockly.inject(blocklyDiv,
        {toolbox: document.getElementById('toolbox'),
		     grid:
		       {spacing:20,
				   length:3,
			     colour: '#ccc', 
				   snap: true},
           trashcan: true});
      //inject the workspace blocks
      var workspaceBlocks = document.getElementById("workspaceBlocks");
      Blockly.Xml.domToWorkspace(workspaceBlocks, workspacePlayground);      
      
      var onresize = function(e) {
        // Compute the absolute coordinates and dimensions of blocklyArea.
        var element = blocklyArea;
        var x = 0;
        var y = 0;
        do {
          x += element.offsetLeft;
          y += element.offsetTop;
          element = element.offsetParent;
        } while (element);
        // Position blocklyDiv over blocklyArea.
        blocklyDiv.style.left = x + 'px';
        blocklyDiv.style.top = y + 'px';
        blocklyDiv.style.width = blocklyArea.offsetWidth + 'px';
        blocklyDiv.style.height = blocklyArea.offsetHeight + 'px';
      };
      window.addEventListener('resize', onresize, false);
      onresize();
      Blockly.svgResize(workspacePlayground);

      //traducao dos blocos para codigo
      function myUpdateFunction(event) {
        var code = Blockly.Python.workspaceToCode(workspacePlayground);
        document.getElementById('codearea').innerHTML = code;
      }
      workspacePlayground.addChangeListener(myUpdateFunction);

      function saveSketch(){
        var code = Blockly.Python.workspaceToCode(workspacePlayground);
        //do something
        uriContent = "data:application/octet-stream," + encodeURIComponent(code);
        newWindow = window.open(uriContent, 'translatedCode');
      }
  </script>
  </body>
</html>